package com.example.ordersagaoutbox.domain.outbox.entity;

import jakarta.persistence.*;
import lombok.*;
import org.springframework.stereotype.Service;

import java.time.Instant;
import java.util.UUID;

@Entity
@Table(name = "inventory_outbox")
@Getter @Setter @Builder @AllArgsConstructor @NoArgsConstructor
public class OutboxEntity {
    public enum Status { PENDING, SENT, FAILED }

    @Id @GeneratedValue(strategy=GenerationType.IDENTITY)
    private Long id;

    private String aggregateId;     // orderId 등 상관키
    private String type;            // EventTypes 값
    @Lob @Column(columnDefinition="TEXT")
    private String payload;         // JSON

    @Enumerated(EnumType.STRING)
    private Status status;

    private int attempts;
    private String lastError;
    private Instant createdAt;
    private Instant sentAt;

    @PrePersist public void pre(){ if(createdAt==null) createdAt=Instant.now(); if(status==null) status=Status.PENDING; }

}
